# Terraform Configuration для SCIFiC

Проект призначений для розгортання серверу в хмарі Hetzner 
для хостингу на ньому вебсайту конференції SCIFiC.

В цьому проекті замість Terraform використовувався
OpenTofu. Але, якщо ви бажаєте використовувати
Terrarom, потрібно просто замінити в команді утиліту 
`tofu` на `terraform`.


## Перед початком

Необхідно виконати команду, яка ініціалізує OpenTofu.
Вона завантажить провайдерів, що використовуються
в конфігураційних файлах, і створить інші файли, що 
необхідні їй для роботи.

```console
$ tofu init
```


## Як розгорнути?

Необхідно використати наступну команду:

```console
$ tofu apply
```

Якщо не були задані потрібні змінні (див. далі по тексту),
користувачу буде запропоновано ввести їх. Далі буде
створений віддалений сервер за допомогою API, що надається 
визначеним в конфігурації хмарним провайдером. Після цього,
команда виведе IP-адреси (4-ї, і 6-ї версії) для створеного
сервера.

Як тільки сервер буде створений і отримає публічну IP-адресу, 
автоманично почне виконуватись 
[цей плейбук](https://github.com/wadofan/mage-ansible-playbook),
за допомогою якого сервер буде налаштований для запуску
[цього проекту](https://github.com/wadofan/mage-docker).


## Як "загорнути"?

Щоб видалити сервер і все інше, що може бути в конфігурації,
необхідно скористатися командою:

```console
$ tofu destroy
```


## Змінні

Для доступу до API хмарного провайдера (в нашому випадку Hetzner)
використовуєтсья змінна `hcloud_token`, в яку потрібно записати
API токен, створений за допомогою web-інтерфейсу провайдера.

Крім цього, використовується змінна `primary_ssh_key`, що
містить назву SSH ключа, що був створений за допомогою 
того ж web-інтерфейсу та буде доданий до новоствореного 
сервера для доступу по SSH.

Задати значення змінним можна:

- у файлі із закінченням .tfvars (наприклад, `terraform.tfvars`),
- під час виконання команди за допомогою аргументів командного рядка,
- під час виконання команди, коли вона попросить ввести значення.

Для налаштування парамертів сервера використовуються наступні змінні:

| Назва                | Опис |
| :------------------- | :--- |
| `hetzner_location`   | Локація в хмарі Hetzner (наприклад, nbg1 або hil) |
| `hetzner_datacenter` | ЦОД в хмарі Hetzner (наприклад, nbg1-dc3 або hil-dc1) |
| `hetzner_vps_type`   | Тип сервера в хмарі Hetzner (наприклад, cx22) |
| `hetzner_image`      | Образ операційної системи для сервера в хмарі Hetzner (наприклад, ubuntu-22.04) |

Крім цього, для автоматизованого запуску плейбука Ansible
були створені такі змінні:

| Назва                 | Опис |
| :-------------------- | :--- |
| `ansible_working_dir` | Робоча директорія для Ansible (директорія з плейбуком) |
| `ansible_remote_user` | Ім'я користувача для входу у віддалену систему |
| `ansible_ssh_key`     | SSH-ключ для доступу до віддаленого сервера |

